<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simple D&D Game</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 650px;
            margin: 10px auto;
            padding: 20px;
            background-color: #f5f5dc; /* Parchment background */
            color: #333;
        }
        .section {
            margin: 10px;
            background-color: #fff;
            padding: 15px;
            border-radius: 5px;
            border: 1px solid #8b4513; /* Brown border */
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        .section h1, .section h2 {
            font-family: 'Georgia', serif;
            color: #8b4513; /* Brown text */
            margin-top: 0;
        }
        .title input {
            font-size: 1.5em;
            width: 94.5%;
            padding: 5px;
            margin-bottom: 0px;
            margin-left: 1.7%;
            border: 1px solid #8b4513;
            border-radius: 3px;
        }
        .stat select {
            margin-left: 10px;
            padding: 5px;
            border: 1px solid #8b4513;
            border-radius: 3px;
        }
        .stat p {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .stat-description {
            font-style: italic;
            color: #555;
        }
        .hp {
            position: relative;
            min-height: 50px;
        }
        .hp-controls {
            display: flex;
            gap: 10px;
            position: absolute;
            bottom: 10px;
            left: 10px;
        }
        .hp button {
            padding: 5px 10px;
            cursor: pointer;
            background-color: #8b4513;
            color: white;
            border: none;
            border-radius: 3px;
        }
        .hp button:hover {
            background-color: #6b3a0f;
        }
        .hp-heart {
            width: 100px;
            height: 115px;
            background-color: #d32f2f;
            color: white;
            font-size: 1em;
            font-weight: bold;
            border: none;
            clip-path: path('M50 30 C20 00, 0 40, 3 50 C0 80, 50 100, 50 100 C50 100, 100 80, 97 50 C100 40, 80 0, 50 30 Z');
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            position: absolute;
            top: 0%;
            right: 10px;
            transform: translateY(-50%);
        }
        .abilities .ability-entry {
            margin-bottom: 10px;
            position: relative;
        }
        .abilities input {
            width: 97%;
            margin: 5px 0;
            padding: 5px;
            border: 1px solid #8b4513;
            border-radius: 3px;
        }
        .abilities .remove-ability {
            position: absolute;
            top: 10px;
            right: 10px;
            background-color: #d32f2f;
            color: white;
            border: none;
            border-radius: 3px;
            padding: 5px 10px;
            cursor: pointer;
        }
        .abilities .remove-ability:hover {
            background-color: #b71c1c;
        }
        .abilities .add-ability {
            background-color: #8b4513;
            color: white;
            border: none;
            border-radius: 3px;
            padding: 8px 15px;
            cursor: pointer;
            margin-top: 10px;
        }
        .abilities .add-ability:hover {
            background-color: #6b3a0f;
        }
        .special-ability .ability-entry {
            margin-bottom: 10px;
            position: relative;
        }
        .special-ability input[type="text"] {
            width: 97%;
            padding: 5px;
            margin: 5px 0;
            border: 1px solid #8b4513;
            border-radius: 3px;
        }
        .special-ability .uses {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .special-ability label {
            margin-right: 10px;
        }
        .special-ability .remove-ability {
            position: absolute;
            top: 10px;
            right: 10px;
            background-color: #d32f2f;
            color: white;
            border: none;
            border-radius: 3px;
            padding: 5px 10px;
            cursor: pointer;
        }
        .special-ability .remove-ability:hover {
            background-color: #b71c1c;
        }
        .special-ability .add-ability {
            background-color: #8b4513;
            color: white;
            border: none;
            border-radius: 3px;
            padding: 8px 15px;
            cursor: pointer;
            margin-top: 10px;
        }
        .special-ability .add-ability:hover {
            background-color: #6b3a0f;
        }
        .dice-roller {
            text-align: left;
        }
        .dice-button {
            width: 100px;
            height: 100px;
            background-color: #FFD700;
            color: white;
            font-size: 1.2em;
            font-weight: bold;
            border: none;
            clip-path: polygon(50% 0%, 100% 25%, 100% 75%, 50% 100%, 0% 75%, 0% 25%);
            cursor: pointer;
            transition: background-color 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            margin: 0 auto;
        }
        .dice-button:hover {
            background-color: #E6B800;
        }
        .notes textarea {
            width: 97%;
            height: 100px;
            margin: 10px 0;
            padding: 5px;
            border: 1px solid #8b4513;
            border-radius: 3px;
        }
        button {
            background-color: #8b4513;
            color: white;
            border: none;
            border-radius: 3px;
            padding: 8px 15px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background-color: #6b3a0f;
        }
        .notes .button-group {
            display: flex;
            gap: 10px;
        }
    </style>
</head>
<body>
    <div class="title">
        <h1>Simple D&D Character Sheet</h1>
        <input type="text" id="player-name" placeholder="Enter Character Name" onchange="saveName()">
    </div>

    <div class="section stat">
        <h2>Stats</h2>
        <p>Constitution: <select id="constitution" onchange="updateStats()">
            <option value="-1">-1</option>
            <option value="0" selected>0</option>
            <option value="1">+1</option>
        </select> <span class="stat-description">Affects HP and defensive rolls.</span></p>
        <p>Power: <select id="power" onchange="updateStats()">
            <option value="-1">-1</option>
            <option value="0" selected>0</option>
            <option value="1">+1</option>
        </select> <span class="stat-description">Affects damage/healing and offensive rolls.</span></p>
        <p>Mind: <select id="mind" onchange="updateStats()">
            <option value="-1">-1</option>
            <option value="0" selected>0</option>
            <option value="1">+1</option>
        </select> <span class="stat-description">Affects roleplay/special ability/non-combat rolls.</span></p>
        <p id="stat-error" style="color: red; display: none;">All stats must be unique!</p>
    </div>

    <div class="section hp">
        <h2>Hit Points (HP)</h2>
        <div class="hp">
            <div class="hp-controls">
                <button onclick="changeHP(1)">+1 HP</button>
                <button onclick="changeHP(-1)">-1 HP</button>
            </div>
            <div class="hp-heart" id="hp-display">5 / 5</div>
        </div>
    </div>

    <div class="section abilities">
        <h2>Abilities/Weapons</h2>
        <p>Damage/Healing: <span id="damage">2</span></p>
        <div id="abilities-container">
            <div class="ability-entry" data-index="0">
                <input type="text" id="ability-0" placeholder="Ability or Weapon 1" onchange="saveAbilities()">
                <button class="remove-ability" onclick="removeWeapon(0)" style="display: none;">-</button>
            </div>
        </div>
        <button class="add-ability" onclick="addWeapon()">+ Add Ability/Weapon</button>
    </div>

    <div class="section special-ability">
        <h2>Special Ability or Tool</h2>
        <p>Bonus effectiveness: <span id="effectiveness">0</span></p>
        <div id="special-abilities-container">
            <div class="ability-entry" data-index="0">
                <input type="text" id="special-ability-0" placeholder="Enter your special ability or tool" onchange="saveSpecialAbilities()">
                <div class="uses">
                    <span>Uses:</span>
                    <label><input type="checkbox" id="use1-0" onchange="saveSpecialAbilities()"></label>
                    <label><input type="checkbox" id="use2-0" onchange="saveSpecialAbilities()"></label>
                    <label><input type="checkbox" id="use3-0" onchange="saveSpecialAbilities()"></label>
                </div>
                <button class="remove-ability" onclick="removeAbility(0)" style="display: none;">-</button>
            </div>
        </div>
        <button class="add-ability" onclick="addAbility()">+ Add Ability</button>
    </div>

    <div class="section dice-roller">
        <h2>Dice Roller (d20)</h2>
        <p align="left"><i>Rolling 1 yields dire failure!</i></p>
        <button class="dice-button" id="dice-button" onclick="rollDice()"><span id="dice-result">-</span></button>
        <p align="right"><i>Rolling 20 yields great success!</i></p>
    </div>

    <div class="section notes">
        <h2>Notes</h2>
        <textarea id="notes" placeholder="Add your notes here..." onchange="saveNotes()"></textarea>
        <div class="button-group">
            <button onclick="saveNotes()">Save Notes</button>
            <button onclick="exportData()">Export Character</button>
            <label for="import-file" style="display: inline-block;">
                <button onclick="document.getElementById('import-file').click()">Import Character</button>
            </label>
            <input type="file" id="import-file" accept=".json" style="display: none;" onchange="importData(event)">
        </div>
    </div>

    <script>
        let currentHP = 5;
        let totalHP = 5;
        let abilityCount = 1;
        let weaponCount = 1;

        function saveName() {
            const name = document.getElementById('player-name').value;
            localStorage.setItem('player-name', name);
        }

        function updateStats() {
            const con = parseInt(document.getElementById('constitution').value) || 0;
            const pow = parseInt(document.getElementById('power').value) || 0;
            const mind = parseInt(document.getElementById('mind').value) || 0;

            // Check for unique stat values
            if (con === pow || con === mind || pow === mind) {
                document.getElementById('stat-error').style.display = 'block';
                return;
            } else {
                document.getElementById('stat-error').style.display = 'none';
            }

            // Update HP based on Constitution
            totalHP = 5 + con;
            currentHP = Math.min(currentHP, totalHP);
            document.getElementById('hp-display').textContent = `${currentHP} / ${totalHP}`;

            // Update damage based on Power
            const damage = 2 + pow;
            document.getElementById('damage').textContent = damage;

            // Update effectiveness based on Mind
            document.getElementById('effectiveness').textContent = mind;

            // Save stats to local storage
            localStorage.setItem('constitution', con);
            localStorage.setItem('power', pow);
            localStorage.setItem('mind', mind);
        }

        function changeHP(amount) {
            currentHP = Math.max(0, Math.min(totalHP, currentHP + amount));
            document.getElementById('hp-display').textContent = `${currentHP} / ${totalHP}`;
            localStorage.setItem('current-hp', currentHP);
        }

        function addWeapon() {
            const container = document.getElementById('abilities-container');
            const index = weaponCount++;
            const weaponDiv = document.createElement('div');
            weaponDiv.className = 'ability-entry';
            weaponDiv.setAttribute('data-index', index);
            weaponDiv.innerHTML = `
                <input type="text" id="ability-${index}" placeholder="Ability or Weapon ${index + 1}" onchange="saveAbilities()">
                <button class="remove-ability" onclick="removeWeapon(${index})">-</button>
            `;
            container.appendChild(weaponDiv);
            updateWeaponRemoveButtons();
            saveAbilities();
        }

        function removeWeapon(index) {
            if (weaponCount <= 1) return; // Prevent removing the last ability/weapon
            const weaponDiv = document.querySelector(`.abilities .ability-entry[data-index="${index}"]`);
            if (weaponDiv) {
                weaponDiv.remove();
                weaponCount--;
                saveAbilities();
                updateWeaponRemoveButtons();
            }
        }

        function updateWeaponRemoveButtons() {
            const buttons = document.querySelectorAll('.abilities .remove-ability');
            buttons.forEach(button => {
                button.style.display = weaponCount > 1 ? 'block' : 'none';
            });
        }

        function saveAbilities() {
            const abilities = [];
            const abilityEntries = document.querySelectorAll('.abilities .ability-entry');
            abilityEntries.forEach(entry => {
                const index = entry.getAttribute('data-index');
                const value = document.getElementById(`ability-${index}`).value;
                abilities.push(value);
            });
            localStorage.setItem('abilities', JSON.stringify(abilities));
        }

        function addAbility() {
            const container = document.getElementById('special-abilities-container');
            const index = abilityCount++;
            const abilityDiv = document.createElement('div');
            abilityDiv.className = 'ability-entry';
            abilityDiv.setAttribute('data-index', index);
            abilityDiv.innerHTML = `
                <input type="text" id="special-ability-${index}" placeholder="Enter your special ability or tool" onchange="saveSpecialAbilities()">
                <div class="uses">
                    <span>Uses:</span>
                    <label><input type="checkbox" id="use1-${index}" onchange="saveSpecialAbilities()"></label>
                    <label><input type="checkbox" id="use2-${index}" onchange="saveSpecialAbilities()"></label>
                    <label><input type="checkbox" id="use3-${index}" onchange="saveSpecialAbilities()"></label>
                </div>
                <button class="remove-ability" onclick="removeAbility(${index})">-</button>
            `;
            container.appendChild(abilityDiv);
            updateRemoveButtons();
            saveSpecialAbilities();
        }

        function removeAbility(index) {
            if (abilityCount <= 1) return; // Prevent removing the last special ability
            const abilityDiv = document.querySelector(`.special-ability .ability-entry[data-index="${index}"]`);
            if (abilityDiv) {
                abilityDiv.remove();
                abilityCount--;
                saveSpecialAbilities();
                updateRemoveButtons();
            }
        }

        function updateRemoveButtons() {
            const buttons = document.querySelectorAll('.special-ability .remove-ability');
            buttons.forEach(button => {
                button.style.display = abilityCount > 1 ? 'block' : 'none';
            });
        }

        function saveSpecialAbilities() {
            const abilities = [];
            const abilityEntries = document.querySelectorAll('.special-ability .ability-entry');
            abilityEntries.forEach(entry => {
                const index = entry.getAttribute('data-index');
                abilities.push({
                    name: document.getElementById(`special-ability-${index}`).value,
                    use1: document.getElementById(`use1-${index}`).checked,
                    use2: document.getElementById(`use2-${index}`).checked,
                    use3: document.getElementById(`use3-${index}`).checked
                });
            });
            localStorage.setItem('special-abilities', JSON.stringify(abilities));
        }

        function saveNotes() {
            const notes = document.getElementById('notes').value;
            localStorage.setItem('notes', notes);
            alert('Notes saved!');
        }

        function rollDice() {
            const result = Math.floor(Math.random() * 20) + 1;
            document.getElementById('dice-result').textContent = result;
        }

        function exportData() {
            const data = {
                'player-name': document.getElementById('player-name').value,
                'constitution': document.getElementById('constitution').value,
                'power': document.getElementById('power').value,
                'mind': document.getElementById('mind').value,
                'current-hp': currentHP,
                'abilities': JSON.parse(localStorage.getItem('abilities') || '[]'),
                'special-abilities': JSON.parse(localStorage.getItem('special-abilities') || '[]'),
                'notes': document.getElementById('notes').value
            };
            const json = JSON.stringify(data, null, 2);
            const blob = new Blob([json], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${document.getElementById('player-name').value || 'character'}_simple_sheet.json`;
            a.click();
            URL.revokeObjectURL(url);
        }

        function importData(event) {
            const file = event.target.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    const fields = ['player-name', 'constitution', 'power', 'mind', 'notes'];
                    fields.forEach(field => {
                        if (data[field] !== undefined) {
                            document.getElementById(field).value = data[field];
                            localStorage.setItem(field, data[field]);
                        }
                    });
                    if (data['current-hp'] !== undefined) {
                        currentHP = parseInt(data['current-hp']);
                        localStorage.setItem('current-hp', currentHP);
                    }
                    if (data['abilities']) {
                        const container = document.getElementById('abilities-container');
                        container.innerHTML = '';
                        weaponCount = 0;
                        data['abilities'].forEach((ability, index) => {
                            const weaponDiv = document.createElement('div');
                            weaponDiv.className = 'ability-entry';
                            weaponDiv.setAttribute('data-index', index);
                            weaponDiv.innerHTML = `
                                <input type="text" id="ability-${index}" placeholder="Ability or Weapon ${index + 1}" value="${ability || ''}" onchange="saveAbilities()">
                                <button class="remove-ability" onclick="removeWeapon(${index})">-</button>
                            `;
                            container.appendChild(weaponDiv);
                            weaponCount = index + 1;
                        });
                        localStorage.setItem('abilities', JSON.stringify(data['abilities']));
                        updateWeaponRemoveButtons();
                    }
                    if (data['special-abilities']) {
                        const container = document.getElementById('special-abilities-container');
                        container.innerHTML = '';
                        abilityCount = 0;
                        data['special-abilities'].forEach((ability, index) => {
                            const abilityDiv = document.createElement('div');
                            abilityDiv.className = 'ability-entry';
                            abilityDiv.setAttribute('data-index', index);
                            abilityDiv.innerHTML = `
                                <input type="text" id="special-ability-${index}" placeholder="Enter your special ability or tool" value="${ability.name || ''}" onchange="saveSpecialAbilities()">
                                <div class="uses">
                                    <span>Uses:</span>
                                    <label><input type="checkbox" id="use1-${index}" ${ability.use1 ? 'checked' : ''} onchange="saveSpecialAbilities()"></label>
                                    <label><input type="checkbox" id="use2-${index}" ${ability.use2 ? 'checked' : ''} onchange="saveSpecialAbilities()"></label>
                                    <label><input type="checkbox" id="use3-${index}" ${ability.use3 ? 'checked' : ''} onchange="saveSpecialAbilities()"></label>
                                </div>
                                <button class="remove-ability" onclick="removeAbility(${index})">-</button>
                            `;
                            container.appendChild(abilityDiv);
                            abilityCount = index + 1;
                        });
                        localStorage.setItem('special-abilities', JSON.stringify(data['special-abilities']));
                        updateRemoveButtons();
                    }
                    updateStats();
                    document.getElementById('hp-display').textContent = `${currentHP} / ${totalHP}`;
                    alert('Character data imported successfully!');
                } catch (err) {
                    alert('Error importing data: Invalid JSON file.');
                }
            };
            reader.readAsText(file);
        }

        // Load saved data on page load
        window.onload = function() {
            const savedName = localStorage.getItem('player-name');
            if (savedName) document.getElementById('player-name').value = savedName;

            const savedCon = localStorage.getItem('constitution');
            const savedPow = localStorage.getItem('power');
            const savedMind = localStorage.getItem('mind');
            if (savedCon !== null) document.getElementById('constitution').value = savedCon;
            if (savedPow !== null) document.getElementById('power').value = savedPow;
            if (savedMind !== null) document.getElementById('mind').value = savedMind;

            const savedAbilities = localStorage.getItem('abilities');
            if (savedAbilities) {
                const abilities = JSON.parse(savedAbilities);
                const container = document.getElementById('abilities-container');
                container.innerHTML = '';
                weaponCount = 0;
                abilities.forEach((ability, index) => {
                    const weaponDiv = document.createElement('div');
                    weaponDiv.className = 'ability-entry';
                    weaponDiv.setAttribute('data-index', index);
                    weaponDiv.innerHTML = `
                        <input type="text" id="ability-${index}" placeholder="Ability or Weapon ${index + 1}" value="${ability || ''}" onchange="saveAbilities()">
                        <button class="remove-ability" onclick="removeWeapon(${index})">-</button>
                    `;
                    container.appendChild(weaponDiv);
                    weaponCount = index + 1;
                });
                updateWeaponRemoveButtons();
            }

            const savedSpecialAbilities = localStorage.getItem('special-abilities');
            if (savedSpecialAbilities) {
                const abilities = JSON.parse(savedSpecialAbilities);
                const container = document.getElementById('special-abilities-container');
                container.innerHTML = '';
                abilityCount = 0;
                abilities.forEach((ability, index) => {
                    const abilityDiv = document.createElement('div');
                    abilityDiv.className = 'ability-entry';
                    abilityDiv.setAttribute('data-index', index);
                    abilityDiv.innerHTML = `
                        <input type="text" id="special-ability-${index}" placeholder="Enter your special ability or tool" value="${ability.name || ''}" onchange="saveSpecialAbilities()">
                        <div class="uses">
                            <span>Uses:</span>
                            <label><input type="checkbox" id="use1-${index}" ${ability.use1 ? 'checked' : ''} onchange="saveSpecialAbilities()"></label>
                            <label><input type="checkbox" id="use2-${index}" ${ability.use2 ? 'checked' : ''} onchange="saveSpecialAbilities()"></label>
                            <label><input type="checkbox" id="use3-${index}" ${ability.use3 ? 'checked' : ''} onchange="saveSpecialAbilities()"></label>
                        </div>
                        <button class="remove-ability" onclick="removeAbility(${index})">-</button>
                    `;
                    container.appendChild(abilityDiv);
                    abilityCount = index + 1;
                });
                updateRemoveButtons();
            }

            updateStats();
            const savedHP = localStorage.getItem('current-hp');
            if (savedHP !== null) {
                currentHP = parseInt(savedHP);
                document.getElementById('hp-display').textContent = `${currentHP} / ${totalHP}`;
            }

            const savedNotes = localStorage.getItem('notes');
            if (savedNotes !== null) document.getElementById('notes').value = savedNotes;
        };
    </script>
</body>
</html>
